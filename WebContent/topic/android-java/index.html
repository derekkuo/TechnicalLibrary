<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>享受Android应用程序的Java技术盛宴</title>
<link rel="stylesheet" type="text/css" href="../../css/techlib-topic.css">
<script type="text/javascript" src="../../js/jquery-1.4.3.min.js"></script>
<script type="text/javascript" src="../../js/techlib-topic.js"></script>
</head>

<div id="techlib-topic">
	<!-- 此行不用编辑 --><a name="top"></a><!-- 文件顶部锚点 -->
	
	<div id="techlib-topic-head"><!-- 文章头 -->
		<div id="title"><h1>享受Android应用程序的Java技术盛宴</h1></div><!-- 标题 -->
		<div id="subtitle"></div><!-- 副标题 -->
		<div id="authorline">作者：<a class="ad" href="http://www.chinatarena.com/">达内总部中关村中心</a>&nbsp;</span>
			<span id="author"></span>
		</div><!-- 作者信息 -->
	</div>
	
	<!-- 此行不用编辑 -->
	<div id="techlib-topic-rightbar">
		<div id="ad-topic-rightbar-bottom"><a class="ad" href="http://www.chinatarena.com/">北京达内：www.chinatarena.com</a></div>
	</div><!-- 目录 将会由jquery程序填充 -->
		
	<!-- 正文内容开始 -->
	<div id="techlib-topic-content">
		<!-- <span class="menu"><h2>引言</h2></span>
 		-->
		<!-- 标签行BEGIN -->
		<div id="techlib-tagsline">
			<strong>标签：</strong>
			<a class="ad" href="http://www.chinatarena.com/">Java培训</a>&nbsp;<a class="ad" href="http://www.chinatarena.com/">达内</a>
			<span id="tags">
				<a class="search" href="#">android</a>
				<a class="search" href="#">Java</a>
			</span>
		</div><!-- 标签行END -->
	

<P><SPAN style="FONT-FAMILY: 黑体"><STRONG>Java&#8482; 语言是 Android 开发人员所选的工具。Android 运行时使用自己的虚拟机 Dalvik，这并不是多数程序开发人员使用的普通 Java 虚拟机。Dalvik 支持 Java 编程语言的大部分功能——但并不是全部。eBay软件架构师</STRONG></SPAN><SPAN style="FONT-FAMILY: 黑体"><A class=dwauthor title="" href="http://www.ibm.com/developerworks/cn/xml/x-gourmetandroid/#author1" rel=#authortip1 jquery1286845399750="22" hoverintent_t="undefined"><STRONG><FONT color=#4c6e94>Michael Galpin</FONT></STRONG></A><STRONG>写了一篇文章《<A href="http://www.ibm.com/developerworks/xml/library/x-gourmetandroid/index.html">Gourmet Java technology for Android applications</A>》，通过本文，您将学习高级 Java 功能及其如何在 Android 中实现。这些功能包括并发性、联网和数据库访问。<A href="http://www.ibm.com/cn/zh/">IBM developerWorks</A>上发布了本文的<A href="http://www.ibm.com/developerworks/cn/xml/x-gourmetandroid/#f1">中文版</A>，现转载于此。</STRONG></SPAN>全文如下：</P>
<P><STRONG>准备开始</STRONG></P>
<P>本文介绍几种处理复杂情况的 Android SDK 工具。开发 Android 应用程序，需要最新版 Android SDK，这需要一个 Java Development Kit (JDK)。我使用的是 Android 2.2 和 JDK 1.6.0_17。物理设备不是必须的；本文中的所有代码在 SDK 附带的 Android 模拟器上可以很好的运行。本文假设您对 Android 编程比较熟悉，故不涉及 Android 基础开发，但是如果您有 Java 编程语言的知识，也是可以的。</P>
<P><STRONG>并发性和联网</STRONG></P>
<P>Android 应用程序一个最常见的任务就是检索数据或通过网络将数据发送到远程服务器。这一操作的结果通常是一些您想要展示给用户的新数据。这意味着您需要修改用户界面。大多数开发人员知道您将不会执行一个潜在的长期运行任务，例如，在主 UI 线程上通过网络访问数据（特别使用一个网络连接非常慢的手机）。冻结您的应用程序直至长期运行任务完成。事实上，如果这个任务超过5 秒，Android 操作系统将出现臭名昭著的 Application Not Responding 对话框，如图1所示。</P>
<P style="TEXT-ALIGN: center"><IMG style="CURSOR: pointer" onclick="window.open('http://articles.csdn.net/uploads/allimg/101012/28_101012091248_1.jpg')" height=587 alt="" src="http://articles.csdn.net/uploads/allimg/101012/28_101012091248_1.jpg" width=480 border=0></P>
<P style="TEXT-ALIGN: center">图 1. Android 臭名昭著的 Application Not Responding 对话框</P>
<P style="TEXT-ALIGN: left">您不可能知道用户网络连接能有多慢。为了避免冒险，您必须在不同的线程上执行任务，或者至少不在主 UI 线程上执行。许多 Android 应用程序，但不是全部，需要处理多线程，由此引起并发。应用程序经常需要本地保存数据，Android 数据库是一个很好的选择。这三个场景（不同线程，并发和本地保存数据）在 Java 环境中有许多标准 方法可以用来处理。然而，正如您将要看到的，Android 提供不同的选择。让我们逐个看看，看看其优点和缺点。</P>
<P><STRONG>Android 网络</STRONG></P>
<P>通过网络使用 Java 编程进行调用是简单的，我们熟悉的 java.net 包含几个执行此操作的类。这些类大多数在 Android 中都可用，事实上，您可以使用像 java.net.URL 和 java.net.URLConnection 这样的类，就像您在其他 Java 应用程序中那样。然而，Android 包括 pache HttpClient 库，这是在 Android 上连接网络的首选方法。即使您使用常用 Java 类，Android 实现仍然使用 HttpClient。清单 1 显示了一个使用这个必不可少的库的示例。</P>
<P>清单 1. 在 Android 上使用 Http Client 库</P><PRE><OL class=dp-xml><LI class=alt><SPAN><SPAN>private&nbsp;ArrayList</SPAN><SPAN class=tag>&lt;</SPAN><SPAN class=tag-name>Stock</SPAN><SPAN class=tag>&gt;</SPAN><SPAN>&nbsp;fetchStockData(Stock［］&nbsp;oldStocks)&nbsp; &nbsp;</SPAN></SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;throws&nbsp;ClientProtocolException,&nbsp;IOException{ &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;StringBuilder&nbsp;</SPAN><SPAN class=attribute>sb</SPAN><SPAN>&nbsp;=&nbsp;</SPAN><SPAN class=attribute-value>new</SPAN><SPAN>&nbsp;StringBuilder(); &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(Stock&nbsp;stock&nbsp;:&nbsp;oldStocks){ &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sb.append(stock.getSymbol()); &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sb.append('+'); &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;sb.deleteCharAt(sb.length()&nbsp;-&nbsp;1); &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;</SPAN><SPAN class=attribute>urlStr</SPAN><SPAN>&nbsp;=&nbsp; &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=attribute-value>"http://finance.yahoo.com/d/quotes.csv?f=sb2n&amp;s="</SPAN><SPAN>&nbsp;+&nbsp; &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sb.toString(); &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;HttpClient&nbsp;</SPAN><SPAN class=attribute>client</SPAN><SPAN>&nbsp;=&nbsp;</SPAN><SPAN class=attribute-value>new</SPAN><SPAN>&nbsp;DefaultHttpClient(); &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;HttpGet&nbsp;</SPAN><SPAN class=attribute>request</SPAN><SPAN>&nbsp;=&nbsp;</SPAN><SPAN class=attribute-value>new</SPAN><SPAN>&nbsp;HttpGet(urlStr.toString()); &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;HttpResponse&nbsp;</SPAN><SPAN class=attribute>response</SPAN><SPAN>&nbsp;=&nbsp;</SPAN><SPAN class=attribute-value>client</SPAN><SPAN>.execute(request); &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;BufferedReader&nbsp;</SPAN><SPAN class=attribute>reader</SPAN><SPAN>&nbsp;=&nbsp;</SPAN><SPAN class=attribute-value>new</SPAN><SPAN>&nbsp;BufferedReader( &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;InputStreamReader(response.getEntity().getContent())); &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;</SPAN><SPAN class=attribute>line</SPAN><SPAN>&nbsp;=&nbsp;</SPAN><SPAN class=attribute-value>reader</SPAN><SPAN>.readLine(); &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;</SPAN><SPAN class=attribute>i</SPAN><SPAN>&nbsp;=&nbsp;</SPAN><SPAN class=attribute-value>0</SPAN><SPAN>; &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;ArrayList</SPAN><SPAN class=tag>&lt;</SPAN><SPAN class=tag-name>Stock</SPAN><SPAN class=tag>&gt;</SPAN><SPAN>&nbsp;</SPAN><SPAN class=attribute-value>new</SPAN><SPAN class=attribute>newStocks</SPAN><SPAN>&nbsp;=&nbsp;new&nbsp;ArrayList</SPAN><SPAN class=tag>&lt;</SPAN><SPAN class=tag-name>Stock</SPAN><SPAN class=tag>&gt;</SPAN><SPAN>(oldStocks.length); &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(line&nbsp;!=&nbsp;null){ &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String［］&nbsp;</SPAN><SPAN class=attribute>values</SPAN><SPAN>&nbsp;=&nbsp;</SPAN><SPAN class=attribute-value>line</SPAN><SPAN>.split(","); &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Stock&nbsp;</SPAN><SPAN class=attribute>stock</SPAN><SPAN>&nbsp;=&nbsp;</SPAN><SPAN class=attribute-value>new</SPAN><SPAN>&nbsp;Stock(oldStocks［i］,&nbsp;oldStocks［i］.getId()); &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stock.setCurrentPrice(Double.parseDouble(values［1］)); &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stock.setName(values［2］); &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;newStocks.add(stock); &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=attribute>line</SPAN><SPAN>&nbsp;=&nbsp;</SPAN><SPAN class=attribute-value>reader</SPAN><SPAN>.readLine(); &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i++; &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;newStocks; &nbsp;</SPAN><LI><SPAN>}&nbsp;</SPAN></LI></OL></PRE>
<P>在这段代码中有一组 Stock 对象。这是基本的数据结构对象，保存用户拥有股票信息（比如，代号、价格等）以及更多的个人信息（比如，用户付了多少钱）。您可以使用 HttpClient 类从 Yahoo Finance 检索动态数据（例如，这支股票目前的价格）。HttpClient 包含一个 HttpUriRequest ，在本例中，您可以使用 HttpGet，这是 HttpUriRequest 的一个子类。类似地，当您需要向远程服务器发送数据时，可以使用 HttpPost 类，当您从客户端得到 HttpResponse 时，您能接触到响应的潜在 InputStream、对其进行缓冲、解析来获取股票信息。</P>
<P>现在，您看到了如何通过网络检索数据、如何用这个数据来通过使用多线程智能地更新 Android UI。</P>
<P><STRONG>Android 并发性实践</STRONG></P>
<P>如果您在应用程序的主 UI 线程上运行 清单 1 中的代码，可能会出现 Application Not Responding 对话框，具体视用户网络速度而定。因此必须确定生成一个线程来获取数据。清单 2 显示了一种解决方法。</P>
<P>清单 2. Na&iuml;ve 多线程（别这样，这行不通！）</P><PRE><OL class=dp-xml><LI class=alt><SPAN><SPAN>private&nbsp;void&nbsp;refreshStockData(){ &nbsp;</SPAN></SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;Runnable&nbsp;</SPAN><SPAN class=attribute>task</SPAN><SPAN>&nbsp;=&nbsp;</SPAN><SPAN class=attribute-value>new</SPAN><SPAN>&nbsp;Runnable(){ &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;run()&nbsp;{ &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{ &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArrayList</SPAN><SPAN class=tag>&lt;</SPAN><SPAN class=tag-name>Stock</SPAN><SPAN class=tag>&gt;</SPAN><SPAN>&nbsp;</SPAN><SPAN class=attribute>newStocks</SPAN><SPAN>&nbsp;=&nbsp; &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=attribute-value>fetchStockData</SPAN><SPAN>(stocks.toArray( &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;Stock［stocks.size()］)); &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(int&nbsp;</SPAN><SPAN class=attribute>i</SPAN><SPAN>=</SPAN><SPAN class=attribute-value>0</SPAN><SPAN>;i</SPAN><SPAN class=tag>&lt;</SPAN><SPAN class=tag-name>stocks.size</SPAN><SPAN>();i++){ &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Stock&nbsp;</SPAN><SPAN class=attribute>s</SPAN><SPAN>&nbsp;=&nbsp;</SPAN><SPAN class=attribute-value>stocks</SPAN><SPAN>.get(i); &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.setCurrentPrice( &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;newStocks.get(i).getCurrentPrice()); &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.setName(newStocks.get(i).getName()); &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;refresh(); &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(Exception&nbsp;e)&nbsp;{ &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Log.e("StockPortfolioViewStocks",&nbsp; &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"Exception&nbsp;getting&nbsp;stock&nbsp;data",&nbsp;e); &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;}; &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;Thread&nbsp;</SPAN><SPAN class=attribute>t</SPAN><SPAN>&nbsp;=&nbsp;</SPAN><SPAN class=attribute-value>new</SPAN><SPAN>&nbsp;Thread(task); &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;t.start(); &nbsp;</SPAN><LI class=alt><SPAN>}&nbsp;</SPAN></LI></OL></PRE>
<P>清单 2 的标题声明这是 na&iuml;ve 代码，确实是。在这个例子中，您将调用 清单 1 中的 fetchStockData 方法，将其封装在 Runnable 对象中，并在一个新线程中执行。在这个新线程中，您可以访问 stocks，一个封装 Activity（此类创建了 UI）的成员变量。顾名思义，这是 Stock 对象的一个数据结构（本例中是 java.util.ArrayList）。换句话说，您在两个线程之间共享数据，主 UI 线程和衍生（spawned）线程（在 清单 2 中调用）。当您修改了衍生线程中的共享数据时，通过在 Activity 对象上调用 refresh 方法来更新 UI。</P>
<P>如果您编写了 Java Swing 应用程序，您可能需要遵循一个像这样的模式。然而，这在 Android 中将不能正常工作。衍生线程根本不能修改 UI。因此在不冻结 UI ，但另一方面，在数据收到之后又允许您修改 UI 的情况下，您怎样检索数据？android.os.Handler 类允许您在线程之间协调和通信。清单 3 显示了一个使用 Handler 的已更新 refreshStockData 方法。</P>
<P>清单 3. 实际工作的多线程 — 通过使用 Handler&nbsp;</P><PRE><OL class=dp-xml><LI class=alt><SPAN><SPAN>private&nbsp;void&nbsp;refreshStockData(){ &nbsp;</SPAN></SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ArrayList</SPAN><SPAN class=tag>&lt;</SPAN><SPAN class=tag-name>Stock</SPAN><SPAN class=tag>&gt;</SPAN><SPAN>&nbsp;</SPAN><SPAN class=attribute>localStocks</SPAN><SPAN>&nbsp;=&nbsp; &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=attribute-value>new</SPAN><SPAN>&nbsp;ArrayList</SPAN><SPAN class=tag>&lt;</SPAN><SPAN class=tag-name>Stock</SPAN><SPAN class=tag>&gt;</SPAN><SPAN>(stocks.size()); &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(Stock&nbsp;stock&nbsp;:&nbsp;stocks){ &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;localStocks.add(new&nbsp;Stock(stock,&nbsp;stock.getId())); &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Handler&nbsp;</SPAN><SPAN class=attribute>handler</SPAN><SPAN>&nbsp;=&nbsp;</SPAN><SPAN class=attribute-value>new</SPAN><SPAN>&nbsp;Handler(){ &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;handleMessage(Message&nbsp;msg)&nbsp;{ &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(int&nbsp;</SPAN><SPAN class=attribute>i</SPAN><SPAN>=</SPAN><SPAN class=attribute-value>0</SPAN><SPAN>;i</SPAN><SPAN class=tag>&lt;</SPAN><SPAN class=tag-name>stocks.size</SPAN><SPAN>();i++){ &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stocks.set(i,&nbsp;localStocks.get(i)); &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;refresh(); &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;}; &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;Runnable&nbsp;</SPAN><SPAN class=attribute>task</SPAN><SPAN>&nbsp;=&nbsp;</SPAN><SPAN class=attribute-value>new</SPAN><SPAN>&nbsp;Runnable(){ &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;run()&nbsp;{ &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{ &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArrayList</SPAN><SPAN class=tag>&lt;</SPAN><SPAN class=tag-name>Stock</SPAN><SPAN class=tag>&gt;</SPAN><SPAN>&nbsp;</SPAN><SPAN class=attribute>newStocks</SPAN><SPAN>&nbsp;=&nbsp; &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=attribute-value>fetchStockData</SPAN><SPAN>(localStocks.toArray( &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;Stock［localStocks.size()］)); &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(int&nbsp;</SPAN><SPAN class=attribute>i</SPAN><SPAN>=</SPAN><SPAN class=attribute-value>0</SPAN><SPAN>;i</SPAN><SPAN class=tag>&lt;</SPAN><SPAN class=tag-name>localStocks.size</SPAN><SPAN>();i++){ &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Stock&nbsp;</SPAN><SPAN class=attribute>ns</SPAN><SPAN>&nbsp;=&nbsp;</SPAN><SPAN class=attribute-value>newStocks</SPAN><SPAN>.get(i); &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Stock&nbsp;</SPAN><SPAN class=attribute>ls</SPAN><SPAN>&nbsp;=&nbsp;</SPAN><SPAN class=attribute-value>localStocks</SPAN><SPAN>.get(i); &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls.setName(ns.getName()); &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls.setCurrentPrice(ns.getCurrentPrice()); &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;handler.sendEmptyMessage(RESULT_OK); &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(Exception&nbsp;e)&nbsp;{ &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Log.e("StockPortfolioViewStocks",&nbsp; &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"Exception&nbsp;getting&nbsp;stock&nbsp;data",&nbsp;e); &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp; &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;}; &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;Thread&nbsp;</SPAN><SPAN class=attribute>dataThread</SPAN><SPAN>&nbsp;=&nbsp;</SPAN><SPAN class=attribute-value>new</SPAN><SPAN>&nbsp;Thread(task); &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;dataThread.start(); &nbsp;</SPAN><LI class=alt><SPAN>}&nbsp;</SPAN></LI></OL></PRE>
<P>在 清单 2 和 清单 3 中的代码有两个主要的不同。明显的差异是 Handler 的存在。第二个不同是，在衍生线程中，您不能修改 UI。相反的，当您将消息发送到 Handler，然后由 Handler 来修改 UI。也要注意，在线程中您不能修改 stocks 成员变量，正如您之前所做的。相反地您可以修改数据的本地副本。严格地来说，这是不是必须的，但这更为安全。</P>
<P>清单 3 说明了在并发编程中一些非常普遍的模式：复制数据、将数据解析到执行长期任务的线程中、将结果数据传递回主 UI 线程、以及根据所属数据更新主 UI 线程。Handlers 是 Android 中的主要通信机制，它们使这个模式易于实现。然而，清单 3 中仍然有一些样本代码。幸好，Android 提供方法来封装和消除大多数样本代码。清单 4 演示了这一过程。</P>
<P>清单 4. 用一个 AsyncTask 使多线程更容易</P><PRE><OL class=dp-xml><LI class=alt><SPAN><SPAN>private&nbsp;void&nbsp;refreshStockData()&nbsp;{ &nbsp;</SPAN></SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;AsyncTask</SPAN><SPAN class=tag>&lt;</SPAN><SPAN class=tag-name>Stock</SPAN><SPAN>,&nbsp;Void,&nbsp;ArrayList</SPAN><SPAN class=tag>&lt;</SPAN><SPAN class=tag-name>Stock</SPAN><SPAN class=tag>&gt;</SPAN><SPAN class=tag>&gt;</SPAN><SPAN>(){ &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;void&nbsp;onPostExecute(ArrayList</SPAN><SPAN class=tag>&lt;</SPAN><SPAN class=tag-name>Stock</SPAN><SPAN class=tag>&gt;</SPAN><SPAN>&nbsp;result)&nbsp;{ &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=attribute>ViewStocks.this.stocks</SPAN><SPAN>&nbsp;=&nbsp;</SPAN><SPAN class=attribute-value>result</SPAN><SPAN>; &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;refresh(); &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;</SPAN><LI><SPAN>&nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;ArrayList</SPAN><SPAN class=tag>&lt;</SPAN><SPAN class=tag-name>Stock</SPAN><SPAN class=tag>&gt;</SPAN><SPAN>&nbsp;doInBackground(Stock...&nbsp;stocks){ &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{ &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;fetchStockData(stocks); &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(Exception&nbsp;e)&nbsp;{ &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Log.e("StockPortfolioViewStocks",&nbsp;"Exception&nbsp;getting&nbsp;stock&nbsp;data",&nbsp;e); &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;null; &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;}.execute(stocks.toArray(new&nbsp;Stock［stocks.size()］)); &nbsp;</SPAN><LI class=alt><SPAN>}&nbsp;</SPAN></LI></OL></PRE>
<P>如您所见，清单 4 比起 清单 3 样本代码明显减少。您不能创建任何线程或 Handlers。使用 AsyncTask 来封装所有样本代码。要创建 AsyncTask，您必须实现 doInBackground 方法。该方法总是在独立的线程中执行，因此您可以自由调用长期运行任务。它的输入类型来自您所创建的 AsyncTask 的类型参数。在本例中，第一个类型参数是 Stock，因此 doInBackground 获得传递给它的一组 Stock 对象。类似地，它返回一个 ArrayList&lt;Stock&gt;，因为这是 AsyncTask 的第三个类型参数。在此例中，我也选择重写 onPostExecute 方法。这是一个可选方法，如果您需要使用从 doInBackground 返回的数据来进行一些操作，您可以选用这种方法来实现。这个方法总是在主 UI 线程上被执行，因此对于修改 UI 这是一个很好的选择。</P>
<P>有了 AsyncTask，您就完全可以简化多线程代码。它可以将许多并发陷阱从您的开发路径删除，您仍然可以使用 AsyncTask 寻找一些潜在问题，例如，在 doInBackground 方法对象执行的同时设备上的方向发生改变时可能发生什么。更多关于如何处理这类案例的技术，见 <A href="http://www.ibm.com/developerworks/cn/xml/x-gourmetandroid/#resources"><FONT color=#4c6e94>参考资料</FONT></A> 的链接。&nbsp;</P>
<P>现在我们开始讨论另一个常见任务，其中 Android 明显背离常用的 Java 方法——使用数据库进行处理。</P>
<P><STRONG>Android 数据库连通性</STRONG></P>
<P>Android 中一个非常有用的特征就是存在本地关系数据库。保证您能在本地文件中存储您的数据，但通常更有用的是使用一个关系型数据库管理系统（Relational Database Management System，RDBMS）来存储。Android 提供给您常用的 SQLite 数据库来进行处理，因为对于像 Android 这类嵌入式系统它是高度优化的。它被 Android 上的核心应用程序所用。例如，用户地址簿是存储在一个 SQLite 数据库中。现在，对于给定的 Android 的 Java 实现，您可以使用 JDBC 来访问这些数据库。出人意料的是，Android 甚至包括构成主要部分 JDBC API 的 java.sql 和 javax.sql 包。然而，当涉及使用本地 Android 数据库进行处理时，这毫无用处。相反地，您想要使用 android.database 和 android.database.sqlite 包。清单 5 是一个使用这些类存储和检索数据的示例。</P>
<P>清单 5. 使用 Android 进行数据库访问&nbsp;</P><PRE><OL class=dp-xml><LI class=alt><SPAN><SPAN>public&nbsp;class&nbsp;StocksDb&nbsp;{ &nbsp;</SPAN></SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;String&nbsp;</SPAN><SPAN class=attribute>DB_NAME</SPAN><SPAN>&nbsp;=&nbsp;</SPAN><SPAN class=attribute-value>"stocks.db"</SPAN><SPAN>; &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;int&nbsp;</SPAN><SPAN class=attribute>DB_VERSION</SPAN><SPAN>&nbsp;=&nbsp;</SPAN><SPAN class=attribute-value>1</SPAN><SPAN>; &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;String&nbsp;</SPAN><SPAN class=attribute>TABLE_NAME</SPAN><SPAN>&nbsp;=&nbsp;</SPAN><SPAN class=attribute-value>"stock"</SPAN><SPAN>; &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;String&nbsp;</SPAN><SPAN class=attribute>CREATE_TABLE</SPAN><SPAN>&nbsp;=&nbsp;</SPAN><SPAN class=attribute-value>"CREATE&nbsp;TABLE&nbsp;"</SPAN><SPAN>&nbsp;+&nbsp; &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TABLE_NAME&nbsp;+&nbsp;"&nbsp;(id&nbsp;INTEGER&nbsp;PRIMARY&nbsp;KEY,&nbsp;symbol&nbsp;TEXT,&nbsp;max_price&nbsp;DECIMAL(8,2),&nbsp;"&nbsp;+ &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"min_price&nbsp;DECIMAL(8,2),&nbsp;price_paid&nbsp;DECIMAL(8,2),&nbsp;"&nbsp;+ &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"quantity&nbsp;INTEGER)"; &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;String&nbsp;</SPAN><SPAN class=attribute>INSERT_SQL</SPAN><SPAN>&nbsp;=&nbsp;</SPAN><SPAN class=attribute-value>"INSERT&nbsp;INTO&nbsp;"</SPAN><SPAN>&nbsp;+&nbsp;TABLE_NAME&nbsp;+ &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;(symbol,&nbsp;max_price,&nbsp;min_price,&nbsp;price_paid,&nbsp;quantity)&nbsp;"&nbsp;+ &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"VALUES&nbsp;(?,?,?,?,?)"; &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;String&nbsp;</SPAN><SPAN class=attribute>READ_SQL</SPAN><SPAN>&nbsp;=&nbsp;</SPAN><SPAN class=attribute-value>"SELECT&nbsp;id,&nbsp;symbol,&nbsp;max_price,&nbsp;"</SPAN><SPAN>&nbsp;+ &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"min_price,&nbsp;price_paid,&nbsp;quantity&nbsp;FROM&nbsp;"&nbsp;+&nbsp;TABLE_NAME; &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;Context&nbsp;context; &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;SQLiteOpenHelper&nbsp;helper; &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;SQLiteStatement&nbsp;stmt; &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;SQLiteDatabase&nbsp;db; &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;StocksDb(Context&nbsp;context){ &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=attribute>this.context</SPAN><SPAN>&nbsp;=&nbsp;context; &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=attribute>helper</SPAN><SPAN>&nbsp;=&nbsp;</SPAN><SPAN class=attribute-value>new</SPAN><SPAN>&nbsp;SQLiteOpenHelper(context,&nbsp;DB_NAME,&nbsp;null,&nbsp; &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DB_VERSION){ &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;onCreate(SQLiteDatabase&nbsp;db)&nbsp;{ &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db.execSQL(CREATE_TABLE); &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;</SPAN><LI><SPAN>&nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;onUpgrade(SQLiteDatabase&nbsp;db,&nbsp;int&nbsp;oldVersion,&nbsp; &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;newVersion)&nbsp;{ &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;UnsupportedOperationException(); &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}; &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=attribute>db</SPAN><SPAN>&nbsp;=&nbsp;</SPAN><SPAN class=attribute-value>helper</SPAN><SPAN>.getWritableDatabase(); &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=attribute>stmt</SPAN><SPAN>&nbsp;=&nbsp;</SPAN><SPAN class=attribute-value>db</SPAN><SPAN>.compileStatement(INSERT_SQL); &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Stock&nbsp;addStock(Stock&nbsp;stock){ &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stmt.bindString(1,&nbsp;stock.getSymbol()); &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stmt.bindDouble(2,&nbsp;stock.getMaxPrice()); &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stmt.bindDouble(3,&nbsp;stock.getMinPrice()); &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stmt.bindDouble(4,&nbsp;stock.getPricePaid()); &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stmt.bindLong(5,&nbsp;stock.getQuantity()); &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;</SPAN><SPAN class=attribute>id</SPAN><SPAN>&nbsp;=&nbsp;(int)&nbsp;stmt.executeInsert(); &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;Stock&nbsp;(stock,&nbsp;id); &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;ArrayList</SPAN><SPAN class=tag>&lt;</SPAN><SPAN class=tag-name>Stock</SPAN><SPAN class=tag>&gt;</SPAN><SPAN>&nbsp;getStocks()&nbsp;{ &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Cursor&nbsp;</SPAN><SPAN class=attribute>results</SPAN><SPAN>&nbsp;=&nbsp;</SPAN><SPAN class=attribute-value>db</SPAN><SPAN>.rawQuery(READ_SQL,&nbsp;null); &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArrayList</SPAN><SPAN class=tag>&lt;</SPAN><SPAN class=tag-name>Stock</SPAN><SPAN class=tag>&gt;</SPAN><SPAN>&nbsp;</SPAN><SPAN class=attribute>stocks</SPAN><SPAN>&nbsp;=&nbsp; &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=attribute-value>new</SPAN><SPAN>&nbsp;ArrayList</SPAN><SPAN class=tag>&lt;</SPAN><SPAN class=tag-name>Stock</SPAN><SPAN class=tag>&gt;</SPAN><SPAN>(results.getCount()); &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(results.moveToFirst()){ &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;</SPAN><SPAN class=attribute>idCol</SPAN><SPAN>&nbsp;=&nbsp;</SPAN><SPAN class=attribute-value>results</SPAN><SPAN>.getColumnIndex("id"); &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;</SPAN><SPAN class=attribute>symbolCol</SPAN><SPAN>&nbsp;=&nbsp;</SPAN><SPAN class=attribute-value>results</SPAN><SPAN>.getColumnIndex("symbol"); &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;</SPAN><SPAN class=attribute>maxCol</SPAN><SPAN>&nbsp;=&nbsp;</SPAN><SPAN class=attribute-value>results</SPAN><SPAN>.getColumnIndex("max_price"); &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;</SPAN><SPAN class=attribute>minCol</SPAN><SPAN>&nbsp;=&nbsp;</SPAN><SPAN class=attribute-value>results</SPAN><SPAN>.getColumnIndex("min_price"); &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;</SPAN><SPAN class=attribute>priceCol</SPAN><SPAN>&nbsp;=&nbsp;</SPAN><SPAN class=attribute-value>results</SPAN><SPAN>.getColumnIndex("price_paid"); &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;</SPAN><SPAN class=attribute>quanitytCol</SPAN><SPAN>&nbsp;=&nbsp;</SPAN><SPAN class=attribute-value>results</SPAN><SPAN>.getColumnIndex("quantity"); &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;do&nbsp;{ &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Stock&nbsp;</SPAN><SPAN class=attribute>stock</SPAN><SPAN>&nbsp;=&nbsp;</SPAN><SPAN class=attribute-value>new</SPAN><SPAN>&nbsp;Stock(results.getString(symbolCol),&nbsp; &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;results.getDouble(priceCol),&nbsp; &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;results.getInt(quanitytCol),&nbsp; &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;results.getInt(idCol)); &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stock.setMaxPrice(results.getDouble(maxCol)); &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stock.setMinPrice(results.getDouble(minCol)); &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stocks.add(stock); &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;while&nbsp;(results.moveToNext()); &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!results.isClosed()){ &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;results.close(); &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;stocks; &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;close(){ &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;helper.close(); &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;</SPAN><LI><SPAN>}&nbsp;</SPAN></LI></OL></PRE>
<P>清单 5 中的类完全封装了一个用于存储股票信息的 SQLite 数据库。因为您将要使用一个嵌入式数据库，不仅是您的应用程序要使用它，而且也要通过应用程序来创建它。您需要提供代码来创建该数据库。Android 提供一个有用的抽象帮助类 SQLiteOpenHelper。要完成这一操作，您需要扩展这个抽象类并提供代码通过使用 onCreate 方法创建您的数据库。当您有一个帮助程序实例时，就可以获取一个 SQLiteDatabase 实例，您可以用来执行任意 SQL 语句。</P>
<P>您的数据库类有两个较为方便的方法。第一个是 addStock，用于将新股票保存到数据库中。注意，您使用了一个 SQLiteStatement 实例，这类似于一个 java.sql.PreparedStatement。需要注意的是，在您的类构造器中如何对其进行编译，使其在每次调用 addStock 时都能重复利用。在每个 addStock 调用中，SQLiteStatement 的变量（INSERT_SQL 字符串中的问号）必然要将数据传递给 addStock。再一次强调，这类似于 PreparedStatement ，您可以从 JDBC 了解它。</P>
<P>另一个方法是 getStocks。顾名思义，它从数据库中检索所有股票。注意，您再次使用一个 SQL 字符串，正如您在 JDBC 中所用的那样。您可以在 SQLiteDatabase 类上通过使用 rawQuery 方法来进行处理。这个类也有几个查询方法，让您可以不使用 SQL 直接查询数据库。所有这些方法都返回一个 Cursor 对象，和 java.sql.ResultSet 非常相似。您可以将 Cursor 移动到从数据库中返回的数据所在行，在每一行，您可以使用 getInt、getString 和其他的方法来检索您要查询的数据库中各列相关的值。再一次强调，这和 ResultSet 十分相似。也和 ResultSet 比较相似，当您完成操作之后，关闭 Cursor 也十分重要的。如果您没有关闭 Cursors，那么可能会迅速地耗尽内存并导致您的应用程序崩溃。</P>
<P>查询本地数据库是一个比较慢的过程，特别是，如果您有多行数据或者您需要在多个表之间运行复杂的查询语句。然而，数据库查询或插入超过 5 秒且出现一个 Application Not Responding 对话框，这种情况不太可能发生，但是当您的数据库忙于读取和写入数据时，冻结您的 UI 是不明智的。当然，避免这种情况最好的办法是使用 AsyncTask。清单 6 展示了这个示例。</P>
<P>清单 6. 在一个单独的线程上插入数据库</P><PRE><OL class=dp-xml><LI class=alt><SPAN><SPAN>Button&nbsp;</SPAN><SPAN class=attribute>button</SPAN><SPAN>&nbsp;=&nbsp;(Button)&nbsp;findViewById(R.id.btn); &nbsp;</SPAN></SPAN><LI><SPAN>button.setOnClickListener(new&nbsp;OnClickListener(){ &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;onClick(View&nbsp;v)&nbsp;{ &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;</SPAN><SPAN class=attribute>symbol</SPAN><SPAN>&nbsp;=&nbsp;</SPAN><SPAN class=attribute-value>symbolIn</SPAN><SPAN>.getText().toString(); &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;symbolIn.setText(""); &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;double&nbsp;</SPAN><SPAN class=attribute>max</SPAN><SPAN>&nbsp;=&nbsp;</SPAN><SPAN class=attribute-value>Double</SPAN><SPAN>.parseDouble(maxIn.getText().toString()); &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maxIn.setText(""); &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;double&nbsp;</SPAN><SPAN class=attribute>min</SPAN><SPAN>&nbsp;=&nbsp;</SPAN><SPAN class=attribute-value>Double</SPAN><SPAN>.parseDouble(minIn.getText().toString()); &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;minIn.setText(""); &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;double&nbsp;</SPAN><SPAN class=attribute>pricePaid</SPAN><SPAN>&nbsp;=&nbsp; &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=attribute-value>Double</SPAN><SPAN>.parseDouble(priceIn.getText().toString()); &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;priceIn.setText(""); &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;</SPAN><SPAN class=attribute>quantity</SPAN><SPAN>&nbsp;=&nbsp;</SPAN><SPAN class=attribute-value>Integer</SPAN><SPAN>.parseInt(quantIn.getText().toString()); &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quantIn.setText(""); &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Stock&nbsp;</SPAN><SPAN class=attribute>stock</SPAN><SPAN>&nbsp;=&nbsp;</SPAN><SPAN class=attribute-value>new</SPAN><SPAN>&nbsp;Stock(symbol,&nbsp;pricePaid,&nbsp;quantity); &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stock.setMaxPrice(max); &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stock.setMinPrice(min); &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;AsyncTask</SPAN><SPAN class=tag>&lt;</SPAN><SPAN class=tag-name>Stock</SPAN><SPAN>,Void,Stock</SPAN><SPAN class=tag>&gt;</SPAN><SPAN>(){ &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;Stock&nbsp;doInBackground(Stock...&nbsp;newStocks)&nbsp;{ &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;There&nbsp;can&nbsp;be&nbsp;only&nbsp;one! &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;db.addStock(newStocks［0］); &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;void&nbsp;onPostExecute(Stock&nbsp;s){ &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addStockAndRefresh(s); &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;</SPAN><LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}.execute(stock); &nbsp;</SPAN><LI class=alt><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;</SPAN><LI><SPAN>});&nbsp;</SPAN></LI></OL></PRE>
<P>您可以先为按钮创建一个实践监听器。当用户点击按钮时，您可以从各个小部件（确切地说是 EditText 小部件）读取股票数据并填入一个新的 Stock 对象。您可以创建一个 AsyncTask，并通过 doInBackground 方法从 清单 5 中调用 addStock 方法。如此，addStock 将在一个背景线程上执行，而不是在主 UI 线程上。完成之后，将新 Stock 对象从数据库传递到在主 UI 线程上执行的 addStockAndRefresh 方法。</P>
<P><STRONG>结束语</STRONG></P>
<P>本文显示了，即使 Android 在 Java 环境下仅支持众多 API 的一个子集，但是其功能却一点都不逊色。在某些示例中，比如网络，它完全实现了熟悉的 API，也提供了一些更为便捷的方法。在其他的示例中，比如并发性，Android 添加了额外 API 以及一些必须遵循的惯例。最后，在数据库访问案例中，Android 提供了完全不同的方法来访问数据库，但使用的是熟悉的概念。这不仅仅是标准 Java 和 Android Java 技术之间主观上的差异：它们形成了Android 开发的基础构建元件。</P>
<P><STRONG>作者简介：</STRONG></P>
<P><STRONG>Michael Galpin</STRONG></P>
<P><SPAN style="PADDING-RIGHT: 20px; PADDING-LEFT: 20px; FLOAT: left; PADDING-BOTTOM: 20px; PADDING-TOP: 20px; TEXT-ALIGN: center"><IMG style="DISPLAY: block" onclick="window.open('http://articles.csdn.net/uploads/allimg/101012/28_101012092227_1.jpg')" height=80 alt="" src="http://articles.csdn.net/uploads/allimg/101012/28_101012092227_1.jpg" width=64 border=0>Michael Galpin</SPAN></P>
<P>Michael Galpin 是 eBay 的一名架构师。他经常为 developerWorks 撰写文章，同时在 TheServerSide.com 和 Java Developer 期刊上发表文章，他还有自己的 <A href="http://fupeg.blogspot.com/"><FONT color=#4c6e94>博客</FONT></A>。他从 1998 年开始做职业程序员，并拥有加州理工学院数学专业的学士学位。</P>
<P>原文链接：<A href="http://www.ibm.com/developerworks/cn/xml/x-gourmetandroid/#f1">http://www.ibm.com/developerworks/cn/xml/x-gourmetandroid/#f1</A></P>



		
		
	</div><!-- #techlib-topic-content 内容结束 -->
</div><!-- #techlib-topic 结束 -->
<!-- 此行不用编辑 --><div style="PAGE-BREAK-AFTER: always; margin-bottom:50px;"></div><!-- 打印时分页 -->
<!-- 此行不用编辑 --><div id="techlib-topic-notelist"></div><!-- 这个区域用于抽取正文中NOTE内容 -->